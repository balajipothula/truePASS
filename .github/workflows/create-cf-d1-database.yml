name: '🛢 Create • Cf • D1 • Database'
description: 'Creating Cloudflare D1 Database resource using Wrangler Action v3.14.1'

on:
  workflow_dispatch:
    inputs:
      database-name:
        type: string
        default: 'truepass_db'
        description: 'Cloudflare D1 Database Name'
        required: true
      location:
        type: choice
        default: apac
        options: [apac, eeur, enam, oc, wnam, weur]
        description: 'Cloudflare D1 Database Location'
        required: true
      create-d1-database:
        type: boolean
        default: false
        description: 'Create Cloudflare D1 Database'
        required: true

jobs:
  create_d1_database:
    name: 🛢 Create Cloudflare D1 Database
    if: ${{ inputs.database-name && inputs.location && inputs.create-d1-database }}
    runs-on: ubuntu-22.04
    environment: ${{ github.ref }}
    defaults:
      run:
        shell: bash
    steps:
      - name: Step - Checkout ᵛ⁵
        uses: actions/checkout@v5
      - name: Step - Get Runner Public IP Address ᵛ¹·⁰·⁰
        id: step_candidob_get-runner-ip_v1-0-0
        uses: ./.github/actions/candidob_get-runner-ip_v1-0-0
      - name: Step - Deploy to Cloudflare with Wrangler ᵛ³·¹⁴·¹
        id: cf_d1_database
        uses: cloudflare/wrangler-action@v3.14.1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          quiet: false
          wranglerVersion: 4.43.0
          command: |
            d1 create ${{ inputs.database-name }} --location ${{ inputs.location }} --json
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}
